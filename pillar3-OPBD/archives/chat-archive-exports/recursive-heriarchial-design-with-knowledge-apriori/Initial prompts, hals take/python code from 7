class Frame:
    def __init__(self, id, parent=None, problem=None):
        self.id = id
        self.parent = parent
        self.problem = problem
        self.a_priori = []
        self.subproblems = []
        self.solution = None
        self.stage = "PROBLEM_DEFINITION"

def solve_frame(frame, llm, user_interface):
    while frame.stage != "DONE":
        if frame.stage == "PROBLEM_DEFINITION":
            # gather & refine problem
            ...
            frame.stage = "A_PRIORI_INVENTORY"

        elif frame.stage == "A_PRIORI_INVENTORY":
            # gather only priors, enforce gate in UI
            ...
            frame.stage = "DECOMPOSITION"

        elif frame.stage == "DECOMPOSITION":
            # ask LLM to decompose using only frame.a_priori
            frame.subproblems = llm_decompose(frame)
            if not frame.subproblems:
                frame.stage = "SYNTHESIS"
            else:
                frame.stage = "SUBPROBLEM_SOLVE"

        elif frame.stage == "SUBPROBLEM_SOLVE":
            for sp in frame.subproblems:
                subframe = Frame(id=sp.id, parent=frame, problem=sp.statement)
                inherit_priors(subframe, frame)
                solve_frame(subframe, llm, user_interface)
            frame.stage = "SYNTHESIS"

        elif frame.stage == "SYNTHESIS":
            frame.solution = llm_synthesize(frame)
            frame.stage = "DONE"

    return frame.solution
